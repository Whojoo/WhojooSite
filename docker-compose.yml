name: whojoo-site

services:
  api-gateway:
    build: 
      context: .
      dockerfile: api-gateway.Dockerfile
    ports:
      - 5001:80
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ReverseProxy:Clusters:webCluster:Destinations:destination1:Address=http://web:4000
      - ReverseProxy:Clusters:backendCluster:Destinations:destination1:Address=http://server:80
    networks:
      - frontend
      - backend

  web:
    build: 
      context: .
      dockerfile: web.Dockerfile
    networks:
      - frontend

  server:
    build:
      context: .
      dockerfile: server.Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    networks:
      - backend

networks:
  frontend:
  backend: